<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SecureStream Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>🎬 Welcome, {{ username }}!</h2>
        <a href="{{ url_for('auth.logout') }}" class="btn btn-danger">Đăng xuất</a>
    </div>

    <p><strong>Role:</strong> <span class="badge bg-primary text-uppercase">{{ role }}</span></p>

    {% if role == 'user' %}
        <h3>📺 Public Videos</h3>
        <ul class="list-group">
            {% for f in public_files %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ f }}
                    <a href="{{ url_for('stream.play_video', filename=f) }}" class="btn btn-sm btn-outline-primary">Play</a>
                </li>
            {% endfor %}
        </ul>

    {% elif role == 'premium' %}
        <h3>📺 Public Videos</h3>
        <ul class="list-group mb-4">
            {% for f in public_files %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ f }}
                    <a href="{{ url_for('stream.play_video', filename=f) }}" class="btn btn-sm btn-outline-primary">Play</a>
                </li>
            {% endfor %}
        </ul>

        <h3>💎 Premium Videos</h3>
        <ul class="list-group">
            {% for f in premium_files %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ f }}
                    <a href="{{ url_for('stream.play_video', filename=f) }}" class="btn btn-sm btn-outline-warning">Play</a>
                </li>
            {% else %}
                <li class="list-group-item">No premium videos.</li>
            {% endfor %}
        </ul>

    {% elif role == 'creator' %}
        <h3>📤 Upload Your Content</h3>
        <form action="/creator/upload" method="post" enctype="multipart/form-data" class="mb-3">
            <div class="input-group">
                <input type="file" name="file" class="form-control" required>
                <button type="submit" class="btn btn-success">Upload</button>
            </div>
        </form>

        <h4>📄 My Uploaded Files:</h4>
        <ul class="list-group" id="my-content">
            {% for f in uploaded_files %}
                <li class="list-group-item">{{ f }}</li>
            {% else %}
                <li class="list-group-item">No files uploaded yet.</li>
            {% endfor %}
        </ul>

    {% elif role == 'admin' %}
        <h3>🛠️ Admin Panel</h3>

        <h4>📂 Pending Content</h4>
        <ul class="list-group mb-4" id="pending-list">
            {% for filename in pending_files %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ filename }}
                    <form action="/admin/approve/{{ filename }}" method="post" class="d-flex gap-2 align-items-center">
                        <select name="access" class="form-select form-select-sm" required>
                            <option value="public">Public</option>
                            <option value="premium">Premium</option>
                        </select>
                        <input type="hidden" name="approved_by" value="{{ username }}">
                        <button type="submit" class="btn btn-sm btn-primary">Approve</button>
                    </form>
                </li>
            {% else %}
                <li class="list-group-item">No pending files</li>
            {% endfor %}
        </ul>

        <h4>📜 Access Logs</h4>
        <a href="/admin/logs" class="btn btn-outline-dark">View access.log</a>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const uploadForm = document.querySelector('form[action="/creator/upload"]');
    if (uploadForm) {
        uploadForm.onsubmit = async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const res = await fetch("/creator/upload", {
                method: "POST",
                body: formData
            });
            if (res.redirected) {
                window.location = res.url;
                return;
            }
            const data = await res.json();
            if (data.error) {
                alert(data.error);
            }
        };
    }
</script>
</body>
</html>
